name: Lint code

on: [pull_request, push, workflow_call]

jobs:
  linting:
    runs-on: ubuntu-latest

    steps:

      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check for all codebase label
        id: check_label
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = core.getInput('pr_number', { required: true });
            const { data: labels } = await github.rest.issues.listLabelsOnIssue({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
            });
            const hasAllCodebaseLabel = labels.some(label => label.name === 'all codebase');
            return { validate_all_codebase: hasAllCodebaseLabel };
          result-encoding: string
          pr_number: ${{ github.event.pull_request.number }}

      - name: Start linting
        uses: super-linter/super-linter/slim@v5
        env:
          LOG_LEVEL: ERROR
          VALIDATE_ALL_CODEBASE: ${{ steps.check_label.outputs.result }}
          DEFAULT_BRANCH: main
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
